<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mot Passant ‚Äì Connexion</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 520px;
      margin: 60px auto;
      padding: 0 16px;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 14px;
      padding: 18px;
    }
    input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin: 10px 0;
    }
    button {
      padding: 12px 14px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
    }
    .msg {
      margin-top: 12px;
    }
    .small {
      font-size: 13px;
      color: #555;
    }
  </style>
</head>

<body>
  <h1>Mot Passant</h1>

  <div class="card">
    <h2>Connexion (invitation uniquement)</h2>
    <p class="small">
      Entre ton email. Tu recevras un lien magique si ton acc√®s est autoris√©.
    </p>

    <input
      id="email"
      type="email"
      placeholder="email@exemple.com"
      autocomplete="email"
    />

    <button id="btn">Recevoir le lien de connexion</button>

    <div id="msg" class="msg"></div>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // üîê CONFIGURATION SUPABASE
    const SUPABASE_URL = "https://xpvjiyvdvppnfqtbiqop.supabase.co";
    const SUPABASE_ANON_KEY =
      "sb_publishable_YEbCxx94G5nkEEKQP9EbSQ_dAAGUd-B";

    const supabase = createClient(
      SUPABASE_URL,
      SUPABASE_ANON_KEY
    );

    const emailEl = document.getElementById("email");
    const btn = document.getElementById("btn");
    const msg = document.getElementById("msg");

    function setMsg(text) {
      msg.textContent = text;
    }

    btn.addEventListener("click", async () => {
      const email = emailEl.value.trim();
      if (!email) {
        setMsg("Merci de saisir un email.");
        return;
      }

      btn.disabled = true;
      setMsg("Envoi du lien magique‚Ä¶");

      const { error } = await supabase.auth.signInWithOtp({
        email,
        options: {
          emailRedirectTo: window.location.origin
        }
      });

      if (error) {
        setMsg("‚ùå Erreur : " + error.message);
      } else {
        setMsg(
          "‚úÖ Si ton acc√®s est autoris√©, tu vas recevoir un email avec le lien de connexion."
        );
      }

      btn.disabled = false;
    });

    // üîé V√©rification de session (retour via lien magique)
    const {
      data: { session }
    } = await supabase.auth.getSession();

    if (session) {
      setMsg("‚úÖ Connect√©(e). Acc√®s valid√©.");
    }
  </script>
</body>
</html>
